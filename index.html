<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DYICT Register</title>
  <style>
    /* ===== Global Styles ===== */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #f9f9f9);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      margin-top: 40px;
      width: 95%;
      max-width: 650px;
      background: #fff;
      border-radius: 16px;
      padding: 25px 30px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      animation: fadeIn 0.5s ease-in-out;
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
      font-size: 28px;
      color: #2c3e50;
      letter-spacing: 1px;
    }

    h3 {
      margin: 15px 0;
      font-size: 20px;
      color: #34495e;
    }

    .hidden {
      display: none;
    }

    /* ===== Buttons ===== */
    button {
      background: #007bff;
      color: #fff;
      padding: 12px 18px;
      border: none;
      border-radius: 8px;
      margin: 8px;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    button:hover {
      background: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    /* ===== Inputs and Selects ===== */
    select, input, textarea {
      padding: 10px;
      margin: 12px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
      transition: 0.2s;
    }

    select:focus, input:focus, textarea:focus {
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0,123,255,0.5);
      outline: none;
    }

    textarea {
      height: 220px;
      resize: none;
    }

    /* ===== Center Utility ===== */
    .center {
      text-align: center;
    }

    /* ===== Animation ===== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== Panels and Sections ===== */
    #attendancePrompt {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    #attendanceDisplay textarea {
      background: #f8f9fa;
      border: 1px solid #ddd;
      font-family: monospace;
      font-size: 14px;
    }

    /* ===== Admin Panel Buttons ===== */
    #adminPanel button {
      background: #28a745;
    }

    #adminPanel button:hover {
      background: #1e7e34;
    }

    #adminPanel button:nth-child(2) {
      background: #ffc107;
      color: #000;
    }

    #adminPanel button:nth-child(2):hover {
      background: #e0a800;
    }

    #adminPanel button:nth-child(3) {
      background: #dc3545;
    }

    #adminPanel button:nth-child(3):hover {
      background: #c82333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>DYICT Register</h1>

    <!-- Role Selection -->
    <div id="roleSection">
      <div class="center">
        <button onclick="chooseRole('Student')">Student</button>
        <button onclick="chooseRole('Facilitator')">Facilitator</button>
        <button onclick="chooseRole('Admin')">Admin</button>
      </div>
    </div>

    <!-- Class Selection -->
    <div id="classSection" class="hidden">
      <h3>Select your class:</h3>
      <select id="classSelect">
        <option value="Safari">Safari</option>
        <option value="Opera">Opera</option>
        <option value="Hanna">Hanna</option>
        <option value="Mozilla">Mozilla</option>
      </select>
      <div id="studentInput" class="hidden">
        <input type="number" id="studentNumber" placeholder="Enter your number (1â€“25)">
      </div>
      <button onclick="proceedAttendance()">Proceed</button>
      <button onclick="goBack()">Back</button>
    </div>

    <!-- Attendance Marking -->
    <div id="attendanceSection" class="hidden">
      <h3 id="attendancePrompt"></h3>
      <div class="center">
        <button onclick="markAttendance('Present')">Present</button>
        <button onclick="markAttendance('Absent')">Absent</button>
      </div>
    </div>

    <!-- Admin Login -->
    <div id="adminLogin" class="hidden">
      <h3>Admin Login</h3>
      <input type="text" id="adminUser" placeholder="Username">
      <input type="password" id="adminPass" placeholder="Password">
      <button onclick="adminLogin()">Login</button>
      <button onclick="goBack()">Back</button>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
      <h3>Admin Panel</h3>
      <button onclick="viewAttendance()">View Attendance</button>
      <button onclick="exportAttendance()">Export Attendance</button>
      <button onclick="logoutAdmin()">Back</button>
    </div>

    <!-- Attendance Display -->
    <div id="attendanceDisplay" class="hidden">
      <h3>Attendance Records</h3>
      <textarea id="attendanceText" readonly></textarea>
      <button onclick="closeAttendanceDisplay()">Close</button>
    </div>
  </div>

  <script>
    let students = {};
    const attendanceLog = [];
    const facilitators = {
      "Safari": "Mr Bila",
      "Opera": "Mr Joseph",
      "Mozilla": "Mathapelo",
      "Hanna": "Jowi"
    };
    let currentRole = "";
    let currentClass = "";
    let currentName = "";

    // Load students JSON
    fetch('students.json')
      .then(response => response.json())
      .then(data => {
        students = data;
      })
      .catch(err => alert("Failed to load students.json: " + err));

    function chooseRole(role) {
      currentRole = role;
      document.getElementById("roleSection").classList.add("hidden");
      if (role === "Admin") {
        document.getElementById("adminLogin").classList.remove("hidden");
      } else {
        document.getElementById("classSection").classList.remove("hidden");
        if (role === "Student") {
          document.getElementById("studentInput").classList.remove("hidden");
        }
      }
    }

    function goBack() {
      document.querySelectorAll(".container > div").forEach(div => div.classList.add("hidden"));
      document.getElementById("roleSection").classList.remove("hidden");
    }

    function proceedAttendance() {
      currentClass = document.getElementById("classSelect").value;
      if (currentRole === "Facilitator") {
        currentName = facilitators[currentClass] || null;
        if (!currentName) {
          alert("No facilitator assigned to this class.");
          goBack();
          return;
        }
      } else {
        let num = parseInt(document.getElementById("studentNumber").value);
        if (isNaN(num) || num < 1 || num > 25) {
          alert("Invalid number input.");
          return;
        }
        currentName = students[currentClass].find(s => s.id === num)?.name;
      }
      document.getElementById("classSection").classList.add("hidden");
      document.getElementById("attendanceSection").classList.remove("hidden");
      document.getElementById("attendancePrompt").innerText =
        `Hi ${currentName}! Mark your attendance:`;
    }

    function markAttendance(status) {
      attendanceLog.push({
        name: currentName,
        class: currentClass,
        role: currentRole,
        status: status,
        time: new Date().toLocaleString()
      });
      alert(`${currentName} marked as ${status} in ${currentClass}`);
      goBack();
    }

    function adminLogin() {
      const user = document.getElementById("adminUser").value;
      const pass = document.getElementById("adminPass").value;
      if (user === "admin" && pass === "1234") {
        document.getElementById("adminLogin").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
      } else {
        alert("Access Denied. Incorrect credentials.");
      }
    }

    function logoutAdmin() { goBack(); }

    function viewAttendance() {
      if (attendanceLog.length === 0) {
        alert("No attendance has been recorded yet.");
        return;
      }
      document.getElementById("adminPanel").classList.add("hidden");
      document.getElementById("attendanceDisplay").classList.remove("hidden");
      let text = "Name, Class, Role, Status, Time\n\n";
      attendanceLog.forEach(r => {
        text += `${r.name}, ${r.class}, ${r.role}, ${r.status}, ${r.time}\n`;
      });
      document.getElementById("attendanceText").value = text;
    }

    function closeAttendanceDisplay() {
      document.getElementById("attendanceDisplay").classList.add("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
    }

    function exportAttendance() {
      if (attendanceLog.length === 0) {
        alert("No attendance to export.");
        return;
      }
      let csv = "Name,Class,Role,Status,Time\n";
      attendanceLog.forEach(r => {
        csv += `${r.name},${r.class},${r.role},${r.status},${r.time}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "attendance_log.csv";
      link.click();
    }
  </script>
</body>
</html>
